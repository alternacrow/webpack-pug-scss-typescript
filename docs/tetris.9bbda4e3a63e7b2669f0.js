(()=>{"use strict";var e={365:(e,t,r)=>{r.r(t)},218:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Module=void 0;var r=function(){function e(){}return e.prototype.init=function(e){document.querySelectorAll("[data-module]").forEach((function(t){var r,o=null===(r=t.getAttribute("data-module"))||void 0===r?void 0:r.trim().split(/\s+/);e.forEach((function(e){(null==o?void 0:o.includes(e.moduleName))&&new e(t).init()}))}))},e}();t.default=r;var o=function(){function e(e){this.el=e}return e.prototype.init=function(){console.log("initialize module = "+e.moduleName+" =")},e}();t.Module=o},603:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.colors=t.minos=t.tmino=t.lmino=t.jmino=t.zmino=t.smino=t.omino=t.imino=void 0,t.imino=[[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0]],t.omino=[[2,2],[2,2]],t.smino=[[0,3,3],[3,3,0],[0,0,0]],t.zmino=[[4,4,0],[0,4,4],[0,0,0]],t.jmino=[[0,5,0],[0,5,0],[5,5,0]],t.lmino=[[0,6,0],[0,6,0],[0,6,6]],t.tmino=[[0,7,0],[7,7,7],[0,0,0]],t.minos={I:t.imino,O:t.omino,S:t.smino,Z:t.zmino,J:t.jmino,L:t.lmino,T:t.tmino},t.colors=["#000000","#00ffff","#ffff00","#008000","#ff0000","#0000ff","#ffa500","#800080"]},825:function(e,t,r){var o,n=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var i=r(218),a=r(274),l=r(603),u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.SCALE=20,t.BOARD_WIDTH=10,t.BOARD_HEIGHT=20,t.dropCounter=0,t.dropInterval=1e3,t.lastTime=0,t.context=null,t.board=[],t.player={mino:[],pos:{x:0,y:0},score:0},t.draw=function(e,r,o){e.fillStyle="#000",e.fillRect(0,0,t.BOARD_WIDTH,t.BOARD_HEIGHT),t.drawMatrix(e,r,{x:0,y:0}),t.drawMatrix(e,o.mino,o.pos)},t.drawMatrix=function(e,t,r){t.forEach((function(t,o){t.forEach((function(t,n){0!==t&&(e.fillStyle=l.colors[t],e.fillRect(n+r.x,o+r.y,1,1))}))}))},t.boardSweep=function(){var e=a.sweep(t.board),r=e[0],o=e[1];t.board=r,t.player.score+=Math.pow(10,2)*o},t.playerDrop=function(){t.player.pos.y++,a.collide(t.board,t.player.mino,t.player.pos)&&(t.player.pos.y--,t.board=a.merge(t.board,t.player.mino,t.player.pos),t.playerReset(),t.boardSweep(),t.updateScore()),t.dropCounter=0},t.playerMove=function(e){t.player.pos.x+=e,a.collide(t.board,t.player.mino,t.player.pos)&&(t.player.pos.x-=e)},t.playerReset=function(){var e=["T","J","L","O","S","Z","I"];t.player.mino=a.createMino(e[e.length*Math.random()|0]),t.player.pos.y=0,t.player.pos.x=(t.board[0].length/2|0)-(t.player.mino[0].length/2|0),a.collide(t.board,t.player.mino,t.player.pos)&&(t.board.forEach((function(e){return e.fill(0)})),t.player.score=0,t.updateScore())},t.playerRotate=function(e){var r=t.player.pos.x,o=1;for(t.player.mino=a.rotate(t.player.mino,e);a.collide(t.board,t.player.mino,t.player.pos);)if(t.player.pos.x+=o,(o=-(o+(o>0?1:-1)))>t.player.mino[0].length)return t.player.mino=a.rotate(t.player.mino,-e),void(t.player.pos.x=r)},t.update=function(e){if(void 0===e&&(e=0),t.context){var r=e-t.lastTime;t.dropCounter+=r,t.dropCounter>t.dropInterval&&t.playerDrop(),t.lastTime=e,t.draw(t.context,t.board,t.player),requestAnimationFrame(t.update)}},t.updateScore=function(){var e=document.querySelector(".js-score");e&&(e.innerText=t.player.score.toString())},t}return n(t,e),t.prototype.init=function(){var e,t=this,r=this.el.querySelector("canvas.js-tetris");if(this.context=null!==(e=null==r?void 0:r.getContext("2d"))&&void 0!==e?e:null,!r||!this.context)throw new Error("Cannot find canvas");r.width=this.BOARD_WIDTH*this.SCALE,r.height=this.BOARD_HEIGHT*this.SCALE,this.context.scale(this.SCALE,this.SCALE),this.board=a.createMatrix(this.BOARD_HEIGHT,this.BOARD_WIDTH),this.context.fillStyle="#000",this.context.fillRect(0,0,r.width*this.SCALE,r.height*this.SCALE),document.addEventListener("keydown",(function(e){"ArrowLeft"===e.key?t.playerMove(-1):"ArrowRight"===e.key?t.playerMove(1):"ArrowDown"===e.key?t.playerDrop():"z"===e.key?t.playerRotate(-1):"x"===e.key&&t.playerRotate(1)})),this.playerReset(),this.updateScore(),this.update()},t.moduleName="tetris",t}(i.Module);t.default=u},861:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.collide=void 0,t.collide=function(e,t,r){for(var o=0;o<t.length;++o)for(var n=0;n<t[o].length;++n)if(0!==t[o][n]&&0!==(e[o+r.y]&&e[o+r.y][n+r.x]))return!0;return!1}},983:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createMatrix=void 0,t.createMatrix=function(e,t){return Array(e).fill(Array(t).fill(0))}},10:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createMino=void 0;var o=r(603);t.createMino=function(e){return o.minos[e]}},274:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.sweep=t.collide=t.rotate=t.merge=t.createMino=t.createMatrix=void 0;var o=r(983);Object.defineProperty(t,"createMatrix",{enumerable:!0,get:function(){return o.createMatrix}});var n=r(10);Object.defineProperty(t,"createMino",{enumerable:!0,get:function(){return n.createMino}});var i=r(931);Object.defineProperty(t,"merge",{enumerable:!0,get:function(){return i.merge}});var a=r(392);Object.defineProperty(t,"rotate",{enumerable:!0,get:function(){return a.rotate}});var l=r(861);Object.defineProperty(t,"collide",{enumerable:!0,get:function(){return l.collide}});var u=r(624);Object.defineProperty(t,"sweep",{enumerable:!0,get:function(){return u.sweep}})},931:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.merge=void 0,t.merge=function(e,t,r){return void 0===r&&(r={x:0,y:0}),e.map((function(e,o){return e.map((function(e,n){var i=o-r.y,a=n-r.x;return 0<=i&&i<=t.length-1&&0<=a&&a<=t[0].length-1&&t[i][a]||e}))}))}},392:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.rotate=void 0;var o=r(747);t.rotate=function(e,t){var r=o.transpose(e);return t>0?r.map((function(e){return e.reverse()})):r.reverse()}},624:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.sweep=void 0,t.sweep=function(e){var t=0,r=[];return e.forEach((function(e){e.every((function(e){return 0!==e}))?(r.unshift(e.fill(0)),t++):r.push(e)})),[r,t]}},747:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.transpose=void 0,t.transpose=function(e){return e.length?e[0].map((function(t,r){return e.map((function(e){return e[r]}))})):e}},878:function(e,t,r){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),r(365);var n=o(r(825));(new(o(r(218)).default)).init([n.default])}},t={};function r(o){if(t[o])return t[o].exports;var n=t[o]={exports:{}};return e[o].call(n.exports,n,n.exports,r),n.exports}r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r(878)})();